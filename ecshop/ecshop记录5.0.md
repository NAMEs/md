#ecshop 5.0 记录
##微分销记录
###用户扫码
1.关注事件  
在weixin/index.php中：  
a.扫码关注之后首先是进行weixin_user表的插入  
b.然后会在用户关注后进行推送，目前系统是推送[点击绑定]()的链接，而这里的链接是跳转到mobile/user.php?wxid=$wxid.   
c.之后还会进行其他处理：  
会根据微信推送过来的信息，获取扫码的用户的微信信息和二维码中的内容，里面有type这个字段，如果type是4的话，就会将扫码的用户和二维码的拥有者进行暂时的主从关系绑定；如果type是6的话……  
用户点击[点击绑定]()的话，跳到 mobile/user.php?wxid=$wxid，之后进行的是用户进行第三方登录的时候插入users表和绑定上级分销商（如果有进行二维码扫描的话）  


###分享链接
分享的链接地址是跳转到v\_user\_erweima.php这个文件  
这个文件的处理方式：  
如果进去的用户的用户id和链接中带的user\_id不一致的话（即不是分享链接的用户），或者是没登陆，直接插入或者更新一条数据到weixin\_user表中，如果没有登陆的话就会跳转到注册页面中，并且会带一个父id参数过去，这样注册的时候就会绑定相应的用户了



有两个表需要注意：  
1.weixin_user表，这个表是把商城用户和其微信号绑定在一起的表；  
2.users表，用户绑定上级用户就是在这里进行的




##微信授权获取用户信息部分（授权登录）

###手机端

点击我的的时候，先跳到user.php文件中，这是和平时一样的，然后再这个文件中进行是否是微信浏览器的判断，如果是的话就进行授权操作，如果用户授权就跳转到weixin_login.php文件中进行微信登录；  
之后再回到user.php中




